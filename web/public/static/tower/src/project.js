window.__require=function e(t,s,i){function o(c,n){if(!s[c]){if(!t[c]){var h=c.split("/");if(h=h[h.length-1],!t[h]){var a="function"==typeof __require&&__require;if(!n&&a)return a(h,!0);if(r)return r(h,!0);throw new Error("Cannot find module '"+c+"'")}}var l=s[c]={exports:{}};t[c][0].call(l.exports,function(e){return o(t[c][1][e]||e)},l,l.exports,e,t,s,i)}return s[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<i.length;c++)o(i[c]);return o}({common:[function(e,t,s){"use strict";cc._RF.push(t,"2c3059gR89M25+oPbW1rTLZ","common"),t.exports={serverUrl:"https://www.abc.com",holes:[],hole_pos:[{id:1,pos:2},{id:2,pos:1},{id:3,pos:4},{id:4,pos:3},{id:5,pos:6},{id:6,pos:5},{id:7,pos:8},{id:8,pos:7},{id:9,pos:10},{id:10,pos:9},{id:11,pos:12},{id:12,pos:11}],hole_pos_w:[],initCom:function(e){var t=this;cc.loader.loadRes("holes",function(s,i){t.holes=i.json.holes;for(var o=0;o<t.hole_pos.length;o++){var r="hole_"+t.holes[o].odds,c=e.getChildByName(r).getChildByName("hole_mask");t.hole_pos_w[o]=c.convertToWorldSpaceAR(cc.v2(0,0))}})}},cc._RF.pop()},{}],hole:[function(e,t,s){"use strict";cc._RF.push(t,"5cb1eaTQVFKJpas14lFeuP5","hole"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=this.node.name;"00"==(e=e.substr(5,e.length))&&(e="0"),this.node.getChildByName("label").getComponent(cc.Label).string=e}}),cc._RF.pop()},{}],httpUtils:[function(e,t,s){"use strict";cc._RF.push(t,"c6ddbPSTR9O3KKXuw5Wds3D","httpUtils");var i=cc.Class({extends:cc.Component,properties:{},statics:{_instance:null},httpGets:function(e,t,s){var i=cc.loader.getXMLHttpRequest();i.onreadystatechange=function(){if(4===i.readyState&&i.status>=200&&i.status<400){var e=i.responseText;t(e)}},i.open("GET",e,!0),s&&i.setRequestHeader("Authorization","Bearer "+s),cc.sys.isNative&&i.setRequestHeader("Accept-Encoding","gzip,deflate"),i.setRequestHeader("Content-Type","application/json"),i.timeout=5e3,i.send()},httpPost:function(e,t,s,i){var o=cc.loader.getXMLHttpRequest();o.onreadystatechange=function(){if(console.log("xhr.readyState="+o.readyState+"  xhr.status="+o.status),4===o.readyState&&o.status>=200&&o.status<400){var e=o.responseText;s(e)}},o.open("POST",e,!0),i&&o.setRequestHeader("Authorization","Bearer "+i),o.setRequestHeader("Content-Type","application/json"),cc.sys.isNative&&o.setRequestHeader("Accept-Encoding","gzip,deflate"),o.timeout=5e3,o.send(t)}});i._instance=new i,t.exports=i,cc._RF.pop()},{}],main:[function(e,t,s){"use strict";cc._RF.push(t,"38e27fp3pRIs7kC55y62dtL","main"),cc.Class({extends:cc.Component,properties:{m_ball:cc.RigidBody,m_btn:cc.Node,m_press:cc.ProgressBar,m_tower:cc.Node,m_light:cc.Node},onLoad:function(){this.com=e("common"),this.httpUtils=e("httpUtils"),this.com.initCom(this.m_tower),cc.game.setFrameRate(60),cc.director.getPhysicsManager().enabled=!0,this._startPos=this.m_ball.node.position,this.id=0,this.finishAnimation(!1),this._autoBet=!1,this._strength=0;this.m_btn.on("touchstart",function(e){0===this.press&&(this.press=1)},this),this.m_btn.on("touchend",function(e){1===this.press&&(this.press=2,this.flashLight())},this),this.m_btn.on("touchcancel",function(e){1===this.press&&(this.press=2,this.flashLight())},this);var t=this;window.addEventListener("message",function(e){if(console.log("receive message listener",e.data),-1!=JSON.stringify(e.data).indexOf("cmd")){var s=JSON.parse(e.data);"startBetBack"===s.cmd?t.startAnimation(s.resultNum):"setAutoBet"===s.cmd?"true"==s.autoBet?t._autoBet=!0:t._autoBet=!1:"cancelBet"==s.cmd&&t.finishAnimation(!1)}})},flashLight:function(){this.m_light.opacity=0,this.m_light.color=this.m_press.node.getChildByName("bar").color,this.m_light.runAction(cc.repeatForever(cc.sequence(cc.fadeTo(.2,180).easing(cc.easeIn(.2)),cc.fadeOut(.2).easing(cc.easeIn(.2)))))},startAnimation:function(e){this.press=3,this.id=e;var t=758*((this.id+5)/12);console.log(this.id,t),this.m_ball.linearVelocity=cc.v2(0,t);for(var s=0;s<this.m_tower.childrenCount;s++){if(-1!=this.m_tower.children[s].name.indexOf("hole_")){var i=this.m_tower.children[s].getChildByName("pipe").getChildByName("guide1").getChildByName("guide2");i.getComponent(cc.RigidBody).active=!1,i.getComponent(cc.PhysicsBoxCollider).restitution=0,i.getComponent(cc.PhysicsBoxCollider).apply(),this.m_tower.children[s].getChildByName("hole_bg").active=!1,this.m_tower.children[s].getChildByName("label").active=!1}}this.m_light.stopAllActions(),this.m_light.opacity=0,this.m_light.color=this.m_press.node.getChildByName("bar").color,this.m_light.runAction(cc.repeatForever(cc.sequence(cc.fadeIn(.3).easing(cc.easeIn(.3)),cc.delayTime(.6),cc.fadeOut(.2).easing(cc.easeIn(.3)),cc.delayTime(.3),cc.fadeIn(.2).easing(cc.easeIn(.2)),cc.fadeOut(.2).easing(cc.easeIn(.3)),cc.delayTime(.3),cc.fadeIn(.2).easing(cc.easeIn(.2)))))},openGuide:function(){var e=this.id%this.com.hole_pos.length;0==e&&(e=this.com.hole_pos.length);var t=this.com.hole_pos[e-1].pos-1,s="hole_"+this.com.holes[t].odds,i=this.m_tower.getChildByName(s).getChildByName("pipe").getChildByName("guide1").getChildByName("guide2");i.getComponent(cc.RigidBody).active=!0,i.getComponent(cc.PhysicsBoxCollider).restitution=1,i.getComponent(cc.PhysicsBoxCollider).apply();var o="hole_"+this.com.holes[e-1].odds;this.m_tower.getChildByName(o).getChildByName("pipe").getChildByName("guide1").getChildByName("guide2").getComponent(cc.RigidBody).active=!0},finishAnimation:function(e){this.m_light.stopAllActions(),this.m_light.opacity=0;var t=this.id%this.com.hole_pos.length;if(0==t&&(t=this.com.hole_pos.length),this.com.holes.length>0&&e){var s="hole_"+this.com.holes[t-1].odds,i=this.m_tower.getChildByName(s);i.getChildByName("hole_bg").active=!0,i.getChildByName("hole_bg").color=new cc.Color(0,95,21,255),i.getChildByName("label").active=!0}if(this.m_press.progress=0,this.m_press.node.getChildByName("bar").color=new cc.Color(0,0,255,255),this.press=0,this.m_ball.linearVelocity=cc.v2(0,0),this.m_ball.node.position=this._startPos,this._isPost=null,window.parent.postMessage({cmd:"end_bet"},"*"),this._autoBet&&this._strength>0){var o=0;if(o=this._strength>0&&this._strength<=60?60*Math.random():this._strength>60&&this._strength<=90?61+29*Math.random():91+9*Math.random(),this.m_press.progress=o/100,this.m_press.progress<=.4){var r=255*this.m_press.progress*2.5,c=255*this.m_press.progress*2.5,n=255-255*this.m_press.progress*2.5;this.m_press.node.getChildByName("bar").color=new cc.Color(r,c,n,255)}else if(this.m_press.progress<=1){r=255,c=255-255*(this.m_press.progress-.4)/1.5*2.5,n=255*(this.m_press.progress-.4)/1.5*2.5;this.m_press.node.getChildByName("bar").color=new cc.Color(r,c,n,255)}else this.m_press.node.getChildByName("bar").color=new cc.Color(255,0,255,255);this.press=2}},update:function(e){if(1===this.press)if(this.m_press.progress+=.012,this.m_press.progress<=.4){var t=255*this.m_press.progress*2.5,s=255*this.m_press.progress*2.5,i=255-255*this.m_press.progress*2.5;this.m_press.node.getChildByName("bar").color=new cc.Color(t,s,i,255)}else if(this.m_press.progress<=1){t=255,s=255-255*(this.m_press.progress-.4)/1.5*2.5,i=255*(this.m_press.progress-.4)/1.5*2.5;this.m_press.node.getChildByName("bar").color=new cc.Color(t,s,i,255)}else this.m_press.node.getChildByName("bar").color=new cc.Color(255,0,255,255);else if(2===this.press&&!this._isPost){this._isPost=!0;var o=Math.floor(100*this.m_press.progress);o>100&&(o=100),window.parent.postMessage({cmd:"start_bet",strength:o},"*"),this._strength=o}if(3===this.press&&this.m_ball.linearVelocity.y<=0&&(this.press=4,this.openGuide()),4===this.press)for(var r=0;r<this.com.hole_pos.length;r++){var c=this.com.hole_pos_w[r],n=this.m_ball.node.convertToWorldSpaceAR(cc.v2(0,0));if(c.sub(n).mag()<8)return void this.finishAnimation(!0)}}}),cc._RF.pop()},{common:"common",httpUtils:"httpUtils"}]},{},["common","hole","httpUtils","main"]);